<!DOCTYPE html>
<html data-wf-page="6976bad4554906b552056036" data-wf-site="68e9a4589764b573e2afecc9" lang="en">
<head>
  <meta charset="utf-8">
  <title>ZapYields | Mainnet UI Fixed</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/components.css" rel="stylesheet" type="text/css">
  <link href="css/shade-be5342c59f721d0abcf-07a16bef20d09.css" rel="stylesheet" type="text/css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
  
  <style>
    .hidden { display: none !important; }
    .status-msg { font-size: 11px; margin-top: 10px; text-align: center; color: #facc15; }
    .error-text { color: #ff6b6b !important; }
    #yieldDisplay { font-weight: bold; }
  </style>
</head>
<body class="body-2">
  <div class="zy-header">
    <div class="zy-inner">
      <a href="#" class="zy-logo w-inline-block">
        <div class="text-block-31">ZapYields</div>
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 25" fill="none">
          <path d="M8.50001 23.968C8.20001 23.968 7.90001 23.868 7.60001 23.768C6.80001 23.368 6.40001 22.568 6.60001 21.768L7.80001 15.968H6.00001C5.20001 15.968 4.50001 15.468 4.20001 14.768C3.90001 14.068 4.00001 13.268 4.60001 12.768L14.1 2.66801C14.7 2.06801 15.7 1.86801 16.4 2.26801C17.2 2.66801 17.6 3.46801 17.4 4.26801L16.2 10.068H18C18.8 10.068 19.5 10.568 19.8 11.268C20.1 11.968 20 12.768 19.4 13.268L9.90001 23.368C9.50001 23.768 9.00001 23.968 8.50001 23.968Z" fill="#facc15"></path>
        </svg>
      </a>
      <div class="header-btns">
        <a href="#" id="connectBtn" class="zy-connect-wallet w-button">Connect Wallet</a>
        <a href="#" id="disconnectBtn" class="w-button hidden" style="background: #450a0a; margin-left: 10px;">Disconnect</a>
      </div>
    </div>
  </div>

  <div class="zy-main-container">
    <div class="zy-main-app">
      <div class="zmp-inner">
        <h1 class="zy-h1">Vault Portfolio</h1>
        <div class="zy-2-cols">
          <div class="zy-col1">
            <h2 class="heading-9">Investment Panel</h2>
            <div class="div-block-89">
              <div class="amount">
                <div class="amount-label">USDC (Base Mainnet)</div>
                <input placeholder="10.00" type="number" id="amountInput" class="input-field" style="color: white !important;">
              </div>
              <div class="zy-btns">
                <a href="#" id="approveBtn" class="button-3 w-button">1. Approve USDC</a>
                <a href="#" id="zapInBtn" class="zy-approve w-button">2. Zap In</a>
                <a href="#" id="zapOutBtn" class="red-btn w-button" style="margin-top:10px; background: #6b1010;">Zap Out All</a>
              </div>
              <p id="statusLabel" class="status-msg">System Ready</p>
            </div>
          </div>

          <div class="zy-col1">
            <h2 class="heading-9">Live Statistics</h2>
            
            <div class="ls-yb">
              <div class="zy-yb-text">Yield Balance</div>
              <div class="yb-amt-wrap">
                <div class="zy-yb-cur">$</div>
                <div class="zy-yb-amt" id="yieldDisplay">0.00</div>
              </div>
            </div>

            <div class="ls-yb" style="margin-top: 30px; border-top: 1px solid #333; padding-top: 20px;">
              <div class="zy-yb-text">Invite & Earn</div>
              <div class="yb-amt-wrap">
                <a href="#" id="copyRefBtn" class="ref-btn w-button">Copy Referral Link</a>
              </div>
              <div id="downlineStatus" style="font-size: 11px; opacity: 0.5; margin-top: 10px;">Connect wallet to see referrals.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const MAINNET_HEX = "0x2105"; // Base Mainnet
    const VAULT_ADDR = "0xA81F4E89804f3592bcaAC44Af53639e960aeCC7f"; 
    const USDC_ADDR = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";

    const V_ABI = [
      "function zapIn(uint256 a, address r) external",
      "function zapOut() external",
      "function getAccountValue(address u) view returns (uint256)",
      "function getDownlines(address u) view returns (address[] memory)"
    ];
    const U_ABI = ["function approve(address s, uint256 a) public returns (bool)"];

    let signer, provider, vault, usdc;

    window.onload = async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum, "any");
        window.ethereum.on('accountsChanged', () => window.location.reload());
        window.ethereum.on('chainChanged', () => window.location.reload());
        
        const accounts = await provider.listAccounts();
        if (accounts.length > 0 && localStorage.getItem('connected') === 'true') {
          init(accounts[0]);
        }
      }
      
      document.getElementById('connectBtn').onclick = connect;
      document.getElementById('disconnectBtn').onclick = disconnect;
      document.getElementById('approveBtn').onclick = approve;
      document.getElementById('zapInBtn').onclick = zapIn;
      document.getElementById('zapOutBtn').onclick = zapOut;
      document.getElementById('copyRefBtn').onclick = copyLink;
    };

    async function connect() {
      try {
        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: MAINNET_HEX }] });
        const accs = await provider.send("eth_requestAccounts", []);
        localStorage.setItem('connected', 'true');
        init(accs[0]);
      } catch (e) { alert("Please switch to Base Mainnet"); }
    }

    async function init(addr) {
      signer = provider.getSigner();
      vault = new ethers.Contract(VAULT_ADDR, V_ABI, signer);
      usdc = new ethers.Contract(USDC_ADDR, U_ABI, signer);
      
      document.getElementById('connectBtn').classList.add('hidden');
      document.getElementById('disconnectBtn').classList.remove('hidden');
      updateStatus("Connected: " + addr.substring(0, 6) + "...", false);
      refresh(addr);
    }

    async function refresh(addr) {
      try {
        // Safe Read: If this fails, the UI won't break 

[Image of a data validation flowchart]

        const bal = await vault.getAccountValue(addr);
        document.getElementById('yieldDisplay').innerText = ethers.utils.formatUnits(bal, 6);
        
        const team = await vault.getDownlines(addr);
        document.getElementById('downlineStatus').innerText = team.length + " referrals active";
      } catch (e) {
        console.error("Refresh failed, likely due to unverified contract or empty vault:", e);
        document.getElementById('yieldDisplay').innerText = "0.00";
      }
    }

    async function approve() {
      const val = document.getElementById('amountInput').value;
      if (!val || val < 10) return updateStatus("Min 10 USDC required", true);
      try {
        updateStatus("Confirming Approval...", false);
        const tx = await usdc.approve(VAULT_ADDR, ethers.utils.parseUnits(val, 6));
        await tx.wait();
        updateStatus("Approved! Ready to Zap.", false);
      } catch (e) { updateStatus("Approval Failed", true); }
    }

    async function zapIn() {
      const val = document.getElementById('amountInput').value;
      const ref = new URLSearchParams(window.location.search).get('ref') || "0x0000000000000000000000000000000000000000";
      try {
        updateStatus("Processing Zap...", false);
        const tx = await vault.zapIn(ethers.utils.parseUnits(val, 6), ref, { gasLimit: 400000 });
        await tx.wait();
        updateStatus("Zap Success!", false);
        refresh(await signer.getAddress());
      } catch (e) { updateStatus("Zap Failed: Check Bal/Network", true); }
    }

    async function zapOut() {
      try {
        updateStatus("Zapping Out...", false);
        const tx = await vault.zapOut({ gasLimit: 400000 });
        await tx.wait();
        updateStatus("Withdraw Success!", false);
        refresh(await signer.getAddress());
      } catch (e) { updateStatus("Withdraw Failed", true); }
    }

    async function copyLink() {
      if (!signer) return alert("Connect Wallet First");
      const addr = await signer.getAddress();
      const link = window.location.origin + window.location.pathname + "?ref=" + addr;
      navigator.clipboard.writeText(link);
      alert("Referral link copied!");
    }

    function disconnect() {
      localStorage.setItem('connected', 'false');
      window.location.reload();
    }

    function updateStatus(msg, isErr) {
      const s = document.getElementById('statusLabel');
      s.innerText = msg;
      s.className = isErr ? "status-msg error-text" : "status-msg";
    }
  </script>
</body>
</html>