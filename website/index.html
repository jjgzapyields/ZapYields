<!DOCTYPE html>
<html data-wf-page="6976bad4554906b552056036" data-wf-site="68e9a4589764b573e2afecc9" lang="en">
<head>
  <meta charset="utf-8">
  <title>ZapYields | Live Production</title>
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/components.css" rel="stylesheet" type="text/css">
  <link href="css/shade-be5342c59f721d0abcf-07a16bef20d09.css" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body class="body-2">
  <div class="zy-header">
    <div class="zy-inner">
      <div class="zy-logo">ZapYieldsâš¡</div>
      <div class="header-btns">
        <a href="#" id="connectBtn" class="zy-connect-wallet w-button">Connect Wallet</a>
        <a href="#" id="disconnectBtn" class="w-button" style="display:none; background:#450a0a;">Disconnect</a>
      </div>
    </div>
  </div>

  <div class="zy-main-container">
    <div class="zmp-inner">
      <div class="zy-col1">
        <input placeholder="Amount (Min 10)" type="number" id="amountInput" class="input-field" style="color:white;">
        <div class="zy-btns">
          <a href="#" id="approveBtn" class="button-3 w-button">1. Approve</a>
          <a href="#" id="zapInBtn" class="zy-approve w-button">2. Zap In</a>
          <a href="#" id="zapOutBtn" class="red-btn w-button" style="margin-top:10px; background:#6b1010;">Zap Out</a>
        </div>
        <p id="statusLabel" style="color:#facc15; text-align:center; margin-top:10px;">Ready</p>
      </div>
      <div class="ls-yb">
        <div>Vault Value: <strong id="yieldDisplay">$0.00</strong></div>
      </div>
    </div>
  </div>

  <script>
    const VAULT_ADDR = "0xA81F4E89804f3592bcaAC44Af53639e960aeCC7f"; 
    const USDC_ADDR = "0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913";
    const V_ABI = [
        "function zapIn(uint256 a, address r) external",
        "function zapOut() external",
        "function getAccountValue(address u) view returns (uint256)"
    ];

    let signer, provider, vault;

    window.onload = async () => {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum, "any");
        const accs = await provider.listAccounts();
        if (accs.length > 0) setup(accs[0]);
      }
      document.getElementById('connectBtn').onclick = connect;
    };

    async function connect() {
      const accs = await provider.send("eth_requestAccounts", []);
      setup(accs[0]);
    }

    async function setup(addr) {
      signer = provider.getSigner();
      vault = new ethers.Contract(VAULT_ADDR, V_ABI, signer);
      document.getElementById('connectBtn').innerText = addr.substring(0,6) + "...";
      refresh(addr);
    }

    async function refresh(addr) {
      try {
        // Safe Read: Try to get value, if contract reverts, default to 0
        const bal = await vault.getAccountValue(addr);
        document.getElementById('yieldDisplay').innerText = "$" + ethers.utils.formatUnits(bal, 6);
      } catch (e) {
        console.warn("Vault is likely empty or uninitialized. Defaulting to 0.");
        document.getElementById('yieldDisplay').innerText = "$0.00";
      }
    }

    async function zapIn() {
      const val = document.getElementById('amountInput').value;
      try {
        const tx = await vault.zapIn(ethers.utils.parseUnits(val, 6), "0x0000000000000000000000000000000000000000", { gasLimit: 400000 });
        await tx.wait();
        refresh(await signer.getAddress());
      } catch (e) { alert("Transaction failed. Do you have enough USDC?"); }
    }

    function updateStatus(msg) { document.getElementById('statusLabel').innerText = msg; }
  </script>
</body>
</html>