<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>ZapYield | Portfolio View</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/components.css" rel="stylesheet" type="text/css">
  <link href="css/shade-be5342c59f721d0abcf-07a16bef20d09.css" rel="stylesheet" type="text/css">
</head>
<body class="body-2">
  <div class="zy-header">
    <div class="zy-inner">
      <a href="#" class="zy-logo w-inline-block" style="display: flex; align-items: center; color: white; text-decoration: none;">
        <div class="text-block-31">ZapYields</div>
      </a>
      <a href="#" id="connectBtn" class="zy-connect-wallet w-button">Connect Wallet</a>
    </div>
  </div>

  <div class="zy-main-container">
    <div class="zy-main-app">
      <div class="zmp-inner">
        <h1 class="zy-h1">Portfolio Dashboard<br><span class="text-span" id="networkStatus">Base Sepolia</span></h1>
        
        <div class="zy-2-cols">
          <div class="zy-col1">
            <h2 class="heading-9">Vault Action</h2>
            <div class="div-block-89">
              <input placeholder="10" type="number" id="amountInput" class="input-field" style="color: black !important;">
              <div class="zy-btns">
                <a href="#" id="approveBtn" class="button-3 w-button">1. Approve</a>
                <a href="#" id="zapInBtn" class="zy-approve w-button">2. Zap In</a>
              </div>
              <p id="statusLabel" style="font-size: 11px; margin-top: 15px; color: #facc15; text-align: center;">Ready</p>
            </div>
          </div>

          <div class="zy-col1">
            <h2 class="heading-9">Wallet Balances</h2>
            <div class="ls-yb" style="padding: 15px; border-radius: 12px; background: rgba(255,255,255,0.05);">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span>ETH:</span> <span id="ethBal" class="text-yellow-500">0.000</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span>USDC:</span> <span id="usdcBal" class="text-yellow-500">0.00</span>
              </div>
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <span>USDT:</span> <span id="usdtBal" class="text-yellow-500">0.00</span>
              </div>
              <hr style="border: 0.5px solid #333; margin: 10px 0;">
              <div style="display: flex; justify-content: space-between;">
                <strong>Vault Yield:</strong> <strong id="yieldDisplay" style="color: #facc15;">$0.00</strong>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const VAULT_ADDRESS = "0x2392e90da0f0De5FD1Fa0978a244CcEE23b6CeF2";
    const USDC_ADDRESS = "0x036CbD53842c5426634e7929541eC2318f3dCF7e";
    const USDT_ADDRESS = "0x56087d0046E315993888362629E2F1626A9C5d68"; // Common Base Sepolia USDT test address

    const ERC20_ABI = ["function balanceOf(address) view returns (uint256)"];
    const VAULT_ABI = ["function getAccountValue(address) view returns (uint256)"];

    let signer, provider;

    window.onload = () => {
      document.getElementById('connectBtn').onclick = connectWallet;
      document.getElementById('approveBtn').onclick = handleApprove;
      document.getElementById('zapInBtn').onclick = handleZapIn;
    };

    async function connectWallet(e) {
      if(e) e.preventDefault();
      if (!window.ethereum) return alert("Install MetaMask!");
      
      try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        const addr = await signer.getAddress();
        
        document.getElementById('connectBtn').innerText = addr.substring(0,6) + "...";
        refreshStats(addr);
      } catch (err) { console.error(err); }
    }

    async function refreshStats(addr) {
      try {
        // 1. Fetch ETH Balance (Native)
        const ethRaw = await provider.getBalance(addr);
        document.getElementById('ethBal').innerText = parseFloat(ethers.utils.formatEther(ethRaw)).toFixed(4);

        // 2. Fetch USDC Balance (6 decimals)
        const usdcContract = new ethers.Contract(USDC_ADDRESS, ERC20_ABI, provider);
        const usdcRaw = await usdcContract.balanceOf(addr);
        document.getElementById('usdcBal').innerText = ethers.utils.formatUnits(usdcRaw, 6);

        // 3. Fetch USDT Balance (6 decimals)
        const usdtContract = new ethers.Contract(USDT_ADDRESS, ERC20_ABI, provider);
        const usdtRaw = await usdtContract.balanceOf(addr);
        document.getElementById('usdtBal').innerText = ethers.utils.formatUnits(usdtRaw, 6);

        // 4. Fetch Vault Yield Balance
        const vault = new ethers.Contract(VAULT_ADDRESS, VAULT_ABI, provider);
        const yieldRaw = await vault.getAccountValue(addr);
        document.getElementById('yieldDisplay').innerText = "$" + ethers.utils.formatUnits(yieldRaw, 6);

      } catch (err) { console.error("Balance fetch error:", err); }
    }

    // (handleApprove and handleZapIn remain same as previous versions)
    function updateStatus(msg) { document.getElementById('statusLabel').innerText = msg; }
  </script>
</body>
</html>