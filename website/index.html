<!DOCTYPE html><html data-wf-page="6976bad4554906b552056036" data-wf-site="68e9a4589764b573e2afecc9" lang="en">
<head>
  <meta charset="utf-8">
  <title>ZapYield</title>
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/components.css" rel="stylesheet" type="text/css">
  <link href="css/shade-be5342c59f721d0abcf-07a16bef20d09.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Oswald:200,300,400,500,600,700","Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Playfair Display:regular,600,italic,600italic"]  }});</script>
  
  <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js" type="application/javascript"></script>
</head>
<body class="body-2">
  <div class="zy-header">
    <div class="zy-inner">
      <a href="#" class="zy-logo w-inline-block">
        <div class="text-block-31">ZapYields</div>
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewbox="0 0 24 25" fill="none" class="ikonik-91jrm" style="display: inline-block !important;">
          <path d="M8.50001 23.968C8.20001 23.968 7.90001 23.868 7.60001 23.768C6.80001 23.368 6.40001 22.568 6.60001 21.768L7.80001 15.968H6.00001C5.20001 15.968 4.50001 15.468 4.20001 14.768C3.90001 14.068 4.00001 13.268 4.60001 12.768L14.1 2.66801C14.7 2.06801 15.7 1.86801 16.4 2.26801C17.2 2.66801 17.6 3.46801 17.4 4.26801L16.2 10.068H18C18.8 10.068 19.5 10.568 19.8 11.268C20.1 11.968 20 12.768 19.4 13.268L9.90001 23.368C9.50001 23.768 9.00001 23.968 8.50001 23.968Z" fill="currentColor"></path>
        </svg>
      </a>
      <a href="#" id="connectBtn" class="zy-connect-wallet w-button">Connect Wallet</a>
    </div>
  </div>
  <div class="zy-main-container">
    <div class="zy-main-app">
      <div class="zmp-inner">
        <h1 class="zy-h1">Welcome to ZapYields<br><span class="text-span">Alpha Version 1.0</span></h1>
        <div class="zy-2-cols">
          <div class="zy-col1">
            <h2 class="heading-9">Vault Action<br></h2>
            <div class="div-block-89">
              <div class="amount">
                <div class="amount-label">Amount (USDC)</div>
                <input placeholder="10" type="number" id="amountInput" class="input-field" style="color: black !important;">
              </div>
              <div class="zy-btns">
                <a href="#" id="approveBtn" class="button-3 w-button">1. Approve</a>
                <a href="#" id="zapInBtn" class="zy-approve w-button">2. Zap In</a>
                <a href="#" id="zapOutBtn" class="red-btn w-button">ZAP OUT ALL</a>
              </div>
              <p id="statusLabel" style="font-size: 11px; margin-top: 10px; color: #facc15; text-align: center;">Ready</p>
            </div>
          </div>
          <div class="zy-col1">
            <h2 class="heading-9">Live Stats<br></h2>
            <div class="ls-yb">
              <div class="zy-yb-text">Yield Balance</div>
              <div class="yb-amt-wrap">
                <div class="zy-yb-cur">$</div>
                <div class="zy-yb-amt" id="yieldBalanceDisplay">0.00</div>
              </div>
            </div>
            <div class="ls-yb">
              <div class="zy-yb-text">Referral Link</div>
              <div class="yb-amt-wrap">
                <a href="#" id="copyLinkBtn" class="ref-btn w-button">Copy Link</a>
              </div>
            </div>
            <div class="ls-dl">
              <div class="zy-yb-text">Your Team (Downlines)</div>
              <div id="downlineList" class="text-block-32"><em class="italic-text-4">Connect wallet to see referrals.</em></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const VAULT_ADDRESS = "0x2392e90da0f0De5FD1Fa0978a244CcEE23b6CeF2";
    const USDC_ADDRESS = "0x036CbD53842c5426634e7929541eC2318f3dCF7e";
    const VAULT_ABI = [
      "function zapIn(uint256 _amount, address _referrer) external",
      "function zapOut() external",
      "function getAccountValue(address _user) external view returns (uint256)",
      "function getDownlines(address _user) external view returns (address[] memory)"
    ];
    const USDC_ABI = [
      "function approve(address spender, uint256 amount) public returns (bool)"
    ];

    let signer, vaultContract, usdcContract;

    // Use DOMContentLoaded to prevent "null" errors
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById('connectBtn').onclick = connectWallet;
      document.getElementById('approveBtn').onclick = handleApprove;
      document.getElementById('zapInBtn').onclick = handleZapIn;
      document.getElementById('zapOutBtn').onclick = handleZapOut;
      document.getElementById('copyLinkBtn').onclick = copyReferral;
    });

    async function connectWallet(e) {
      if(e) e.preventDefault();
      if (typeof window.ethereum !== 'undefined') {
        try {
          const provider = new ethers.providers.Web3Provider(window.ethereum);
          await provider.send("eth_requestAccounts", []);
          signer = provider.getSigner();
          const addr = await signer.getAddress();
          
          vaultContract = new ethers.Contract(VAULT_ADDRESS, VAULT_ABI, signer);
          usdcContract = new ethers.Contract(USDC_ADDRESS, USDC_ABI, signer);

          document.getElementById('connectBtn').innerText = addr.substring(0,6) + "...";
          updateStatus("Wallet Connected");
          refreshStats(addr);
        } catch (err) { updateStatus("Connection Error"); }
      } else { alert("MetaMask not detected. Use http://localhost"); }
    }

    async function handleApprove(e) {
      if(e) e.preventDefault();
      const val = document.getElementById('amountInput').value;
      if (!val || val < 10) return alert("Minimum 10 USDC required");
      try {
        updateStatus("Approving...");
        const tx = await usdcContract.approve(VAULT_ADDRESS, ethers.utils.parseUnits(val, 6));
        await tx.wait();
        updateStatus("Approved!");
      } catch (err) { updateStatus("Approve Failed"); }
    }

    async function handleZapIn(e) {
      if(e) e.preventDefault();
      const val = document.getElementById('amountInput').value;
      try {
        updateStatus("Zapping...");
        const ref = new URLSearchParams(window.location.search).get('ref') || "0x0000000000000000000000000000000000000000";
        const tx = await vaultContract.zapIn(ethers.utils.parseUnits(val, 6), ref);
        await tx.wait();
        updateStatus("Success!");
        refreshStats(await signer.getAddress());
      } catch (err) { updateStatus("Zap Failed"); }
    }

    async function handleZapOut(e) {
      if(e) e.preventDefault();
      try {
        updateStatus("Withdrawing...");
        const tx = await vaultContract.zapOut();
        await tx.wait();
        updateStatus("Withdrawn!");
        refreshStats(await signer.getAddress());
      } catch (err) { updateStatus("Withdraw Error"); }
    }

    async function refreshStats(addr) {
      try {
        const bal = await vaultContract.getAccountValue(addr);
        document.getElementById('yieldBalanceDisplay').innerText = ethers.utils.formatUnits(bal, 6);
        const downs = await vaultContract.getDownlines(addr);
        if(downs.length > 0) {
            document.getElementById('downlineList').innerHTML = downs.map(d => `<div style="font-size:10px;">${d}</div>`).join('');
        }
      } catch (err) { console.error(err); }
    }

    async function copyReferral(e) {
      if(e) e.preventDefault();
      const addr = await signer.getAddress();
      const link = window.location.origin + window.location.pathname + "?ref=" + addr;
      navigator.clipboard.writeText(link);
      alert("Referral Link Copied!");
    }

    function updateStatus(msg) { document.getElementById('statusLabel').innerText = msg; }
  </script>
</body>
</html>